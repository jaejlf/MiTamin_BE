ifndef::snippets[]
:snippets: /MyTamin_BE/build/generated-snippets
endif::[]

= 💊 My Tamin API Document

'''

.업데이트 내역

* 2022.09.23.금 : 회원가입/로그인/이메일, 닉네임 중복 체크 API 구현
* 2022.09.24.토 : 회원가입 API -> PASSWORD_PATTERN_ERROR 추가 (*비밀번호 패턴 서버 측과 일치하는지 체크)
* 2022.09.26.월 : 홈 화면 관련 API 구현 (세부 로직 구현 전이지만, 업데이트 후에도 response는 동일할 예정임)
* 2022.09.27.화 : 마이타민 섭취, 최근 마이타민 API 구현, 오류 구별을 위한 errorCode 추가
* 2022.09.29.목
       ** 웰컴 메세지 API -> 마이타민 섭취 여부에 따른 웰컴 메세지 구현
       ** 하루 진단 API -> 감정 태그 중복 선택 기능 추가
       ** 전반적인 문서 설명 추가

.참고사항

* 하루 진단하기, 칭찬 처방하기 API의 path가 변경되었습니다.
* 당분간 테이블 변경이 조금씩 있을 것 같습니다. 기존 아이디 로그인 안될 경우에는 DB 비워진 상태이니 재가입해주세요.

'''

== User
=== 회원 가입
* mytaminHour은 24시간 단위의 값으로 요청한다. (ex. 오후 3시 -> "15")
* mytaminHour, mytaminMin은 필수 요청값이 아니므로, 유저가 '건너뛰기'를 선택했을 경우 email, password, nickname 값만 넣어 요청한다.
       ** 이 경우 mytaminHour, mytaminMin의 초기값은 null이다.
       ** 마이타민 섭취 시간 정보는 추후 관련 기능 구현 시 변경 가능성이 있다.
* 회원가입 시 따로 입력받지 않는 profileImgUrl, beMyMessage 의 초기값은 null이다.

operation::auth/signup[snippets='http-request,http-response']
operation::auth/signup[snippets='request-fields,response-fields']

==== Exception Response
* EMAIL_PATTERN_ERROR : 이메일 형식이 정해진 패턴("^[_a-z0-9-]+(.[_a-z0-9-]+)*@(?:\w+\.)+\w+$") 과 다를 경우
* PASSWORD_PATTERN_ERROR : 비밀번호가 정해진 패턴("^(?=.\*[0-9])(?=.*[A-Za-z]).{8,30}$") 과 다를 경우

include::{snippets}/auth/signup_2000/http-response.adoc[]
include::{snippets}/auth/signup_2001/http-response.adoc[]
include::{snippets}/auth/signup_2002/http-response.adoc[]
include::{snippets}/auth/signup_2003/http-response.adoc[]

=== 기본 로그인
* 로그인 성공 시 accessToken과 refreshToken을 발급한다.
* JWT 관련한 세부 내용은 노션 Server 공유 페이지 -> '인증 관련 공통 참고 사항'에서 확인할 수 있다.

operation::auth/defaultLogin[snippets='http-request,http-response']
operation::auth/defaultLogin[snippets='request-fields,response-fields']

==== Exception Response
include::{snippets}/auth/defaultLogin_3000/http-response.adoc[]
include::{snippets}/auth/defaultLogin_3001/http-response.adoc[]

=== 이메일 중복 체크
* 이미 사용 중인 이메일일 경우 true, 사용 가능한 이메일일 경우 false를 리턴한다.

operation::auth/checkEmailDuplication[snippets='http-request,http-response']
operation::auth/checkEmailDuplication[snippets='path-parameters,response-fields']

=== 닉네임 중복 체크
* 이미 사용 중인 닉네임일 경우 true, 사용 가능한 닉네임일 경우 false를 리턴한다.

operation::auth/checkNicknameDuplication[snippets='http-request,http-response']
operation::auth/checkNicknameDuplication[snippets='path-parameters,response-fields']

=== 토큰 재발급
* 새로 발급한 accessToken과 기존의 refreshToken을 리턴한다.
    ** refreshToken의 만료 기간이 2일 이내로 남았을 경우 refreshToken 또한 새로 발급한다.
* 만약 403 응답(= refreshToken 만료)일 경우에는 재로그인하도록 한다.

operation::auth/reissue[snippets='http-request,http-response']
operation::auth/reissue[snippets='request-fields,response-fields']

==== Exception Response
* INVALID_TOKEN_ERROR
    ** DB에 저장된 refresh 토큰과 일치하지 않는 경우
    ** refreshToken 자체가 잘못 되었거나 만료된 경우

include::{snippets}/auth/reissue_1001/http-response.adoc[]
include::{snippets}/auth/reissue_3000/http-response.adoc[]

== Home
=== 웰컴 메세지
* 조건에 따라 웰컴 메시지를 리턴한다.
* 조건 1, 2, 3 순으로 높은 우선 순위가 적용된다.
* 조건
    ** 조건 1. 마이타민 섭취 완료
    *** 오늘 하루도 수고 많았어요 :)
    ** 조건 2. 마이타민 섭취 지정 시간 및 섭취 여부
    *** 섭취 지정 시간 2시간 전 : 오늘의 마이타민 섭취를 잊지마세요 :)
    *** 섭취 지정 시간 2시간 후 : 마이타민 섭취.. 잊으시면 안 돼요 !
    ** 조건 3. 시간에 따른 웰컴 메세지
    *** am 5:00 ~ am 11:59 : 오늘도 힘차게 시작해볼까요 ?
    *** pm 12:00 ~ pm 18:59 : 어떤 하루를 보내고 계신가요 ?
    *** pm 19:00 ~ am 4:59 : 푹 쉬고 내일 만나요

operation::home/welcome[snippets='http-request,http-response']
operation::home/welcome[snippets='request-headers,response-fields']

=== 숨 고르기 완료
* 유저가 '숨 고르기' 행동을 완료했다면 해당 API를 요청한다.
* 해당 API를 요청하면 유저가 '숨 고르기'를 완료한 최종 시간이 업데이트되고, 이 정보는 행동 완료 상태 API에서 유저가 행동을 완료했는지 여부를 계산하는 데에 활용된다.

operation::home/completeBreath[snippets='http-request,http-response']
operation::home/completeBreath[snippets='request-headers,response-fields']

=== 감각 깨우기 완료
* 유저가 '감각 깨우기' 행동을 완료했다면 해당 API를 요청한다.
* 해당 API를 요청하면 유저가 '감각 깨우기'를 완료한 최종 시간이 업데이트되고, 이 정보는 행동 완료 상태 API에서 유저가 행동을 완료했는지 여부를 계산하는 데에 활용된다.

operation::home/completeSense[snippets='http-request,http-response']
operation::home/completeSense[snippets='request-headers,response-fields']

=== 행동 완료 상태
* 1 ~ 4번 행동에 대해 유저가 행동을 완료했다면 true, 완료하지 않았다면 false를 리턴한다.

operation::home/getProgressStatus[snippets='http-request,http-response']
operation::home/getProgressStatus[snippets='request-headers,response-fields']

== Mytamin
=== 최근 섭취한 마이타민
* 하루 진단 or 칭찬 처방 중 하나라도 완료했을 경우 data가 리턴되며, 최근 섭취한 마이타민이 없을 경우 data 값은 null이다.
* 하루 진단을 or 칭찬 처방 중 하나만 완료되었을 경우, 완료되지 않은 행동과 관련된 속성값은 null로 리턴된다.
* 24시간 이내 생성된 마이타민일 경우에는 수정이 가능하다. (canEdit : true)
       ** canEdit 속성값은 추후 하루 진단/칭찬 처방의 수정 기능 구현 시 변경되거나 세분화될 수 있다.

* mentalConditionCode
    ** 1 : "매우 나빠요 .."
    ** 2 : "나쁜 편이에요 :("
    ** 3 : "그럭저럭이에요"
    ** 4 : "좋은 편이에요 :)"
    ** 5 : "매우 좋아요 !"

operation::mytamin/getLatestMytamin[snippets='http-request,http-response']
operation::mytamin/getLatestMytamin[snippets='request-headers,response-fields']

== Report
=== 하루 진단하기
* 마음 컨디션은 String이 아닌, 각 마음 컨디션에 해당하는 int type의 코드를 보낸다.
* 감정 태그 2, 3은 필수 요청값이 아니므로, 유저가 선택하지 않았다면 보내주지 않아도 된다.
* Response의 feelingTag는 Request의 tag1, tag2, tag3을 조합하여 리턴한다.

* mentalConditionCode
** 1 : "매우 나빠요 .."
** 2 : "나쁜 편이에요 :("
** 3 : "그럭저럭이에요"
** 4 : "좋은 편이에요 :)"
** 5 : "매우 좋아요 !"

operation::report/reportToday[snippets='http-request,http-response']
operation::report/reportToday[snippets='request-headers,request-fields,response-fields']

==== Exception Response

include::{snippets}/report/reportToday_4000/http-response.adoc[]
include::{snippets}/report/reportToday_4001/http-response.adoc[]

== Care
=== 칭찬 처방하기
* 칭찬 카테고리는 String이 아닌, 각 카테고리에 해당하는 int type의 코드를 보낸다.
* careCategoryCode
    ** 1 : "이루어 낸 일"
    ** 2 : "잘한 일이나 행동"
    ** 3 : "노력하고 있는 부분"
    ** 4 : "긍정적인 변화나 깨달음"
    ** 5 : "감정, 생각 혹은 신체 일부분"
    ** 6 : "과거의 나"
    ** 7 : "기타"

operation::care/careToday[snippets='http-request,http-response']
operation::care/careToday[snippets='request-headers,request-fields,response-fields']

==== Exception Response

include::{snippets}/care/careToday_5000/http-response.adoc[]
include::{snippets}/care/careToday_5001/http-response.adoc[]