ifndef::snippets[]
:snippets: /MyTamin_BE/build/generated-snippets
endif::[]

= 💊 My Tamin API Document

.업데이트 내역 (2022.10.21.금요일 기준)
* Care
    ** 칭찬 처방 기록 랜덤 조회
    ** 칭찬 처방 히스토리 조회 (정렬 조건 추가 전)
* Report
    ** 주간 마음 컨디션
    ** 이번 달 가장 많이 느낀 감정 TOP3
    ** 월간 마음 컨디션
* 노션 - Server 공유 페이지 업뎃 (날짜/시간 공통 오류 관련 내용 추가)
* 디또클 ... (DB 또 클리어😥)

'''

== Auth
=== 회원 가입
* mytaminHour은 24시간 단위(0 ~ 23)의 값으로 요청한다. (ex. 오후 3시 -> "15")

operation::auth/signUp[snippets='http-request,http-response']
operation::auth/signUp[snippets='request-fields,response-fields']

==== Exception response
* EMAIL_PATTERN_ERROR : 이메일 형식이 정해진 패턴("^[_a-z0-9-]+(.[_a-z0-9-]+)*@(?:\w+\.)+\w+$") 과 다를 경우
* PASSWORD_PATTERN_ERROR : 비밀번호가 정해진 패턴("^(?=.\*[0-9])(?=.*[A-Za-z]).{8,30}$") 과 다를 경우

include::{snippets}/auth/signUp_2000/http-response.adoc[]
include::{snippets}/auth/signUp_2001/http-response.adoc[]
include::{snippets}/auth/signUp_2002/http-response.adoc[]
include::{snippets}/auth/signUp_2003/http-response.adoc[]

=== 기본 로그인
* 로그인 성공 시 accessToken과 refreshToken을 발급한다.

operation::auth/defaultLogin[snippets='http-request,http-response']
operation::auth/defaultLogin[snippets='request-fields,response-fields']

==== Exception response
include::{snippets}/auth/defaultLogin_3000/http-response.adoc[]
include::{snippets}/auth/defaultLogin_3001/http-response.adoc[]

=== 이메일 중복 체크
* 중복된 이메일이 존재할 경우 true, 존재하지 않을 경우 false를 리턴한다.

operation::auth/isEmailDuplicate[snippets='http-request,http-response']
operation::auth/isEmailDuplicate[snippets='path-parameters,response-fields']

=== 닉네임 중복 체크
* 중복된 닉네임이 존재할 경우 true, 존재하지 않을 경우 false를 리턴한다.

operation::auth/isNicknameDuplicate[snippets='http-request,http-response']
operation::auth/isNicknameDuplicate[snippets='path-parameters,response-fields']

=== 토큰 재발급
* 새로 발급한 accessToken과 기존의 refreshToken을 리턴한다.
    ** refreshToken의 만료 기간이 2일 이내로 남았을 경우 refreshToken 또한 새로 발급한다.
* 만약 403 응답(= INVALID_TOKEN_ERROR)일 경우에는 재로그인하도록 한다.

operation::auth/reissueToken[snippets='http-request,http-response']
operation::auth/reissueToken[snippets='request-fields,response-fields']

==== Exception response
* INVALID_TOKEN_ERROR
    ** DB에 저장된 refreshToken과 일치하지 않는 경우
    ** refreshToken 자체가 잘못 되었거나 만료된 경우

include::{snippets}/auth/reissueToken_1001/http-response.adoc[]
include::{snippets}/auth/reissueToken_3000/http-response.adoc[]

== Home
=== 웰컴 메세지
* 조건에 따라 웰컴 메시지를 리턴한다.
* 조건 1, 2, 3 순으로 높은 우선 순위가 적용된다.
* 조건
    ** 조건 1. 마이타민 섭취 완료
    *** 오늘 하루도 수고 많았어요 :)
    ** 조건 2. 마이타민 섭취 지정 시간 및 섭취 여부
    *** 섭취 지정 시간 2시간 전 : 오늘의 마이타민 섭취를 잊지마세요 :)
    *** 섭취 지정 시간 2시간 후 : 마이타민 섭취.. 잊으시면 안 돼요 !
    ** 조건 3. 시간에 따른 웰컴 메세지
    *** am 5:00 ~ am 11:59 : 오늘도 힘차게 시작해볼까요 ?
    *** pm 12:00 ~ pm 18:59 : 어떤 하루를 보내고 계신가요 ?
    *** pm 19:00 ~ am 4:59 : 푹 쉬고 내일 만나요

operation::home/welcome[snippets='http-request,http-response']
operation::home/welcome[snippets='request-headers,response-fields']

=== 행동 완료 상태
* 1 ~ 4번 행동에 대해 유저가 행동을 완료했다면 true, 완료하지 않았다면 false를 리턴한다.

operation::home/getProgressStatus[snippets='http-request,http-response']
operation::home/getProgressStatus[snippets='request-headers,response-fields']

== Mytamin
=== 숨 고르기 완료
* 유저가 '숨 고르기' 행동을 완료했다면 해당 API를 요청한다.
* 해당 API를 요청하면 유저가 '숨 고르기'를 완료한 최종 시간이 업데이트되고, 이 정보는 행동 완료 상태 API에서 유저가 행동을 완료했는지 여부를 계산하는 데에 활용된다.

operation::mytamin/completeBreath[snippets='http-request,http-response']
operation::mytamin/completeBreath[snippets='request-headers,response-fields']

=== 감각 깨우기 완료
* 유저가 '감각 깨우기' 행동을 완료했다면 해당 API를 요청한다.
* 해당 API를 요청하면 유저가 '감각 깨우기'를 완료한 최종 시간이 업데이트되고, 이 정보는 행동 완료 상태 API에서 유저가 행동을 완료했는지 여부를 계산하는 데에 활용된다.

operation::mytamin/completeSense[snippets='http-request,http-response']
operation::mytamin/completeSense[snippets='request-headers,response-fields']

=== 최근 섭취한 마이타민
* 하루 진단 or 칭찬 처방 중 완료하지 않은 행동이 있다면 null로 리턴된다. (ex. data.report : null)
* 하루 진단/칭찬 처방은 작성 후 24시간 이내일 경우 수정이 가능하다.
    ** report.canEdit, care.canEdit은 수정 가능할 경우 true, 불가능할 경우 false를 리턴한다.
* mentalConditionCode
    ** 1 : "매우 나빠요 .."
    ** 2 : "나쁜 편이에요 :("
    ** 3 : "그럭저럭이에요"
    ** 4 : "좋은 편이에요 :)"
    ** 5 : "매우 좋아요 !"

operation::mytamin/getLatestMytamin[snippets='http-request,http-response']
operation::mytamin/getLatestMytamin[snippets='request-headers,response-fields']

== Report
=== 하루 진단하기
* 마음 컨디션은 각 마음 컨디션에 해당하는 int 타입의 코드를 보낸다.
* mentalConditionCode
    ** 1 : "매우 나빠요 .."
    ** 2 : "나쁜 편이에요 :("
    ** 3 : "그럭저럭이에요"
    ** 4 : "좋은 편이에요 :)"
    ** 5 : "매우 좋아요 !"

operation::report/createReport[snippets='http-request,http-response']
operation::report/createReport[snippets='request-headers,request-fields,response-fields']

==== Exception response

include::{snippets}/report/createReport_4000/http-response.adoc[]
include::{snippets}/report/createReport_4001/http-response.adoc[]

=== 하루 진단 조회
* '하루 진단' 작성 시 발급받은 고유 id(= reportId)를 통해 데이터를 조회한다.

operation::report/getReport[snippets='http-request,http-response']
operation::report/getReport[snippets='request-headers,path-parameters,response-fields']

==== Exception response

include::{snippets}/report/getReport_4002/http-response.adoc[]

=== 하루 진단 수정
operation::report/updateReport[snippets='http-request,http-response']
operation::report/updateReport[snippets='request-headers,path-parameters,request-fields,response-fields']

==== Exception response
* EDIT_TIMEOUT_ERROR : 작성 시간 기준, 24시간이 지났다면 수정이 불가능하다.

include::{snippets}/report/updateReport_4002/http-response.adoc[]
include::{snippets}/report/updateReport_7000/http-response.adoc[]

=== 주간 마음 컨디션 조회
* '오늘'을 기준으로 이전 7일 간의 마음 컨디션 기록을 조회한다.
* 해당하는 날짜에 하루 진단 기록이 존재하지 않을 경우, mentalConditionCode는 '0'이다.
* mentalConditionCode
    ** 1 : "매우 나빠요 .."
    ** 2 : "나쁜 편이에요 :("
    ** 3 : "그럭저럭이에요"
    ** 4 : "좋은 편이에요 :)"
    ** 5 : "매우 좋아요 !"

operation::report/getWeeklyMentalReport[snippets='http-request,http-response']
operation::report/getWeeklyMentalReport[snippets='request-headers,response-fields']

=== 이번 달 가장 많이 느낀 감정
operation::report/getMonthlyFeelingRank[snippets='http-request,http-response']
==== Other HTTP response
* 이번 달 느낀 감정이 3개가 되지 않을 경우

[source,http,options="nowrap"]
----
HTTP/1.1 200 OK
Content-Type: application/json;charset=UTF-8
Content-Length: 270

{
  "statusCode" : 200,
  "message" : "이번 달 가장 많이 느낀 감정",
  "data" : [{
    "feeling" : "신나는",
    "count" : 5
  }]
}
----

operation::report/getMonthlyFeelingRank[snippets='request-headers,response-fields']

== Care
=== 칭찬 처방하기
* 칭찬 카테고리는 각 카테고리에 해당하는 int 타입의 코드를 보낸다.
* careCategoryCode
    ** 1 : "이루어 낸 일"
    ** 2 : "잘한 일이나 행동"
    ** 3 : "노력하고 있는 부분"
    ** 4 : "긍정적인 변화나 깨달음"
    ** 5 : "감정, 생각 혹은 신체 일부분"
    ** 6 : "과거의 나"
    ** 7 : "기타"

operation::care/createCare[snippets='http-request,http-response']
operation::care/createCare[snippets='request-headers,request-fields,response-fields']

==== Exception response

include::{snippets}/care/createCare_5000/http-response.adoc[]
include::{snippets}/care/createCare_5001/http-response.adoc[]

=== 칭찬 처방 조회
* '칭찬 처방' 작성 시 발급받은 고유 id(= careId)를 통해 데이터를 조회한다.

operation::care/getCare[snippets='http-request,http-response']
operation::care/getCare[snippets='request-headers,path-parameters,response-fields']

==== Exception response

include::{snippets}/care/getCare_5002/http-response.adoc[]

=== 칭찬 처방 수정
operation::care/updateCare[snippets='http-request,http-response']
operation::care/updateCare[snippets='request-headers,path-parameters,request-fields,response-fields']

==== Exception response
* EDIT_TIMEOUT_ERROR : 작성 시간 기준, 24시간이 지났다면 수정이 불가능하다.

include::{snippets}/care/updateCare_5002/http-response.adoc[]
include::{snippets}/care/updateCare_7000/http-response.adoc[]

=== 칭찬 처방 랜덤 조회
operation::care/getRandomCare[snippets='http-request,http-response']
operation::care/getRandomCare[snippets='request-headers,response-fields']

=== 칭찬 처방 히스토리 조회
* 조건에 따라 칭찬 처방 기록을 조회한다.
* sort, careCategoryCodeList, date는 모두 필수값이 아니다.
* 정렬 조건(sort), 칭찬 카테고리는 각 카테고리에 해당하는 int 타입의 코드를 보낸다.
* sort
    ** 1 : 가장 최근 순
    ** 2 : 가장 오래된 순
    ** 마음 컨디션 관련 조건 -> 칭찬 처방에 해당하는 항목이 아니므로 기획팀에게 문의 예정
* careCategoryCode
    ** 1 : "이루어 낸 일"
    ** 2 : "잘한 일이나 행동"
    ** 3 : "노력하고 있는 부분"
    ** 4 : "긍정적인 변화나 깨달음"
    ** 5 : "감정, 생각 혹은 신체 일부분"
    ** 6 : "과거의 나"
    ** 7 : "기타"

* sort 조건은 현재 어떤 값을 보내도 결과가 동일함 !! (추가 개발 예정)

operation::care/getCareHistroy[snippets='http-request,http-response']
==== Other HTTP response
* date 조건이 없을 경우(= 전체 날짜 조회)

[source,http,options="nowrap"]
----
HTTP/1.1 200 OK
Content-Type: application/json;charset=UTF-8
Content-Length: 490

{
  "statusCode" : 200,
  "message" : "칭찬 처방 히스토리 조회",
  "data" : {
    "careHistory" : {
      "2022년 10월" : [ {
        "careMsg1" : "오늘 할 일을 전부 했어",
        "careMsg2" : "성실히 노력하는 내 모습이 좋아",
        "takeAt" : "10.13.Thu"
      }, {
        "careMsg1" : "꾸준히 칭찬 기록 중이야",
        "careMsg2" : "꾸준한 내 모습을 칭찬해 !",
        "takeAt" : "10.19.Wed"
      } ],
      "2022년 09월" : [ {
        "careMsg1" : "새로운 마음으로 다시 마이타민을 시작했어",
        "careMsg2" : "계속해서 노력하려는 시도가 멋있어",
        "takeAt" : "09.30.Fri"
      }]
    }
  }
}
----
operation::care/getCareHistroy[snippets='request-headers,request-fields,response-fields']

== User
=== 프로필 조회
* 설정된 프로필 이미지가 없을 경우, profileImgUrl은 null로 리턴된다.

operation::user/getProfile[snippets='http-request,http-response']
operation::user/getProfile[snippets='request-headers,response-fields']

=== 프로필 편집
* file의 확장자는 .png, .jpg, .jpeg 또는 null 중 하나여야 한다.
* isImgEdited는 프로필 이미지가 수정되었을 경우 "T", 수정되지 않았을 경우 "F"를 전송한다.
    ** isImgEdited가 "T"가 아닌 경우에는 이미지와 관련된 작업을 아예 진행하지 않으므로, file에는 어떤 값을 넣어도 무관하다. (null 또는 기존 이미지 등)
* nickname, beMyMessage는 수정되지 않았더라도 항상 전송한다.

operation::user/updateProfile[snippets='http-request,http-response']
operation::user/updateProfile[snippets='request-headers,request-parts,request-parameters,response-fields']

==== Exception response

include::{snippets}/user/updateProfile_2003/http-response.adoc[]

== Wish
=== 위시 리스트 조회

operation::wish/getWishlist[snippets='http-request,http-response']
==== Other HTTP response
* 위시 리스트가 존재하지 않을 경우

[source,http,options="nowrap"]
----
HTTP/1.1 200 OK
Content-Type: application/json;charset=UTF-8
Content-Length: 596

{
  "statusCode" : 200,
  "message" : "위시 리스트 조회",
  "data" : {
    "published" : [],
    "hidden" : []
  }
}
----
operation::wish/getWishlist[snippets='request-headers,response-fields']

=== 위시 리스트 업데이트
플로우 확정되면 추가 예정

== Myday
=== 이번 달의 마이데이
* 매달 랜덤으로 마이데이 날짜가 지정된다.
* comment
    ** 마이데이 이전 : "이번 마이데이에는 무엇을 해볼까요 ?"
    ** 마이데이 3일 전 : "두근두근 ! 마이데이가 머지 않았어요",
    ** 마이데이 당일 : "기분 좋은 마이데이 되세요 !",
    ** 마이데이 이후 : "이번 마이데이는 어떤 하루였나요 ?"

operation::myday/getMyday[snippets='http-request,http-response']
operation::myday/getMyday[snippets='request-headers,response-fields']

== Daynote
=== 데이노트 리스트 조회
- 연도별로 그룹핑하여 데이노트 리스트를 리턴한다.
- 년/월을 기준으로 오름차순 정렬되어 리턴된다.
- performedAt은 이미지가 존재하지 않을 경우 대체 제목으로 사용되는 값이다.

operation::daynote/getDaynoteList[snippets='http-request,http-response']
==== Other HTTP response
* 데이노트가 존재하지 않을 경우

[source,http,options="nowrap"]
----
HTTP/1.1 200 OK
Content-Type: application/json;charset=UTF-8
Content-Length: 706

{
  "statusCode" : 200,
  "message" : "데이노트 리스트 조회",
  "data" : {
    "daynoteList" : {}
  }
}
----
operation::daynote/getDaynoteList[snippets='request-headers,response-fields']

=== 데이노트 작성 가능 여부
- 사용자가 선택한 데이노트 작성 날짜를 yyyy.MM 형식으로 요청한다. (ex. 22년 1월 -> 2022.01)
- performedAt에 해당하는 날짜에 데이노트 작성이 가능하면 true, 불가능하면 false를 리턴한다.
- (아직 화면설계서에 반영되지 않았지만) 기획팀과 상의된 플로우
    * 1. 데이노트 작성 가능 여부 체크
    * 1-1. 작성 가능하다면(= true) 데이노트 작성 화면으로 넘어가기
    * 1-2. 작성 불가능하다면(= false, 이미 해당 날짜에 데이노트가 존재한다면) 데이노트 수정/삭제 여부를 묻기

operation::daynote/canCreateDaynote[snippets='http-request,http-response']
operation::daynote/canCreateDaynote[snippets='request-headers,path-parameters,response-fields']

=== 데이노트 작성
* fileList 내 이미지의 확장자는 .png, .jpg, .jpeg 또는 null 중 하나여야 한다.
* 이미지는 최대 5장까지 첨부할 수 있다.
* wishText가 기존에 존재하지 않는 위시라면 자동으로 생성한다.
* 예외처리를 위해 wishId 필드값이 추가될 예정 (asap하게 변경!!예정!)

operation::daynote/createDaynote[snippets='http-request,http-response']
operation::daynote/createDaynote[snippets='request-headers,request-parts,request-parameters,response-fields']

==== Exception response

include::{snippets}/daynote/createDaynote_8004/http-response.adoc[]
include::{snippets}/daynote/createDaynote_6003/http-response.adoc[]

=== 데이노트 조회
* performedAt은 화면설계서 4.2.2.2의 날짜 정보를 대체한다. (기획팀과 상의 완료)

operation::daynote/getDaynote[snippets='http-request,http-response']
operation::daynote/getDaynote[snippets='request-headers,path-parameters,response-fields']

==== Exception response

include::{snippets}/daynote/getDaynote_8003/http-response.adoc[]

=== 데이노트 수정
* fileList 내 이미지의 확장자는 .png, .jpg, .jpeg 또는 null 중 하나여야 한다.
* 이미지는 최대 5장까지 첨부할 수 있다. (아직 반영 전)

operation::daynote/updateDaynote[snippets='http-request,http-response']
operation::daynote/updateDaynote[snippets='request-headers,request-parts,request-parameters,response-fields']

=== 데이노트 삭제

operation::daynote/deleteDaynote[snippets='http-request,http-response']
operation::daynote/deleteDaynote[snippets='request-headers,path-parameters,response-fields']

==== Exception response

include::{snippets}/daynote/deleteDaynote_8003/http-response.adoc[]

== Alarm

=== 알림 설정 상태 조회

operation::alarm/getAlarmSettingStatus[snippets='http-request,http-response']
==== Other HTTP response
* 마이타민, 마이데이 알림이 모두 꺼져있을 경우

[source,http,options="nowrap"]
----
HTTP/1.1 200 OK
Content-Type: application/json;charset=UTF-8
Content-Length: 243

{
  "statusCode" : 200,
  "message" : "알림 설정 상태 조회",
  "data" : {
    "mytamin" : {
      "isOn" : false
    },
    "myday" : {
      "isOn" : false
    }
  }
}
----
operation::alarm/getAlarmSettingStatus[snippets='request-headers,response-fields']

=== 마이타민 알림 ON
* mytaminHour은 24시간 단위(0 ~ 23)의 값으로 요청한다. (ex. 오후 3시 -> "15")

operation::alarm/turnOnMytaminAlarm[snippets='http-request,http-response']
operation::alarm/turnOnMytaminAlarm[snippets='request-headers,request-fields,response-fields']

=== 마이타민 알림 OFF

operation::alarm/turnOffMydayAlarm[snippets='http-request,http-response']
operation::alarm/turnOffMydayAlarm[snippets='request-headers,response-fields']

=== 마이데이 알림 ON
* 마이데이 지정 시간은 각 시간에 해당하는 int 타입의 코드를 보낸다.
* code
    ** 0 : "없음"
    ** 1 : "당일"
    ** 2 : "하루 전"
    ** 3 : "일주일 전"

operation::alarm/turnOnmydayAlarm[snippets='http-request,http-response']
operation::alarm/turnOnmydayAlarm[snippets='request-headers,path-parameters,response-fields']

==== Exception response

include::{snippets}/alarm/turnOnmydayAlarm_3002/http-response.adoc[]

=== 마이데이 알림 OFF

operation::alarm/turnOffMydayAlarm[snippets='http-request,http-response']
operation::alarm/turnOffMydayAlarm[snippets='request-headers,response-fields']

== Image
* Multipart 타입으로 이미지를 전송한다.

=== 단일 이미지 업로드
* 하나의 이미지를 업로드 후, 이미지 URL을 리턴한다.

operation::img/uploadImgOne[snippets='http-request,http-response']
operation::img/uploadImgOne[snippets='request-headers,request-parts,response-fields']

=== 이미지 리스트 업로드
* 하나 이상의 이미지를 업로드 후, 이미지 URL을 리턴한다.

operation::img/uploadImgList[snippets='http-request,http-response']
operation::img/uploadImgList[snippets='request-headers,request-parts,response-fields']

